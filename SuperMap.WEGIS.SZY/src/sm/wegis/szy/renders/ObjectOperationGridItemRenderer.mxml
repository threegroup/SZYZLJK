<?xml version="1.0" encoding="utf-8"?>
<s:DefaultGridItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" 
						   xmlns:s="library://ns.adobe.com/flex/spark"  
						   xmlns:mx="library://ns.adobe.com/flex/mx" 
						   buttonMode="true"
						   left="0" right="0" height="25">
	<fx:Script>
		<![CDATA[
			import com.supermap.wegis.constants.TargetIDConsts;
			import com.supermap.wegis.transData.search.QueryStatisticData;
			import com.supermap.wegis.transData.search.SearchRequestData;
			import com.supermap.wegis.wcsr.mvc.events.BaseDataEvent;
			import com.supermap.wegis.wcsr.mvc.events.MapCtrlEvent;
			import com.supermap.wegis.wcsr.mvc.models.ApplicationModelLocator;
			import com.supermap.wegis.wcsr.mvc.valueObjects.ConstVO;
			
			import mx.collections.ArrayCollection;
			import mx.core.FlexGlobals;
			import mx.core.UIComponent;
			import mx.managers.PopUpManager;
			import mx.utils.ObjectUtil;
			
			import widgets.basedataquery.BaseDataLinkDocPanel;
			
			private var _queryType:String;
			private var queryStatisticData:QueryStatisticData;
			private var _label:String;
			private var modelLocator:ApplicationModelLocator = ApplicationModelLocator.getInstance();
			/**查询类型*/
			public function get queryType():String
			{
				return _queryType;
			}
			
			/**查询类型*/
			public function set queryType(value:String):void
			{
				_queryType = value;
			}
			
			override public function set data(value:Object):void
			{
				if(value == null)
					return;
				super.data = value;
				if(data.hasOwnProperty("CENTER_X") && data["CENTER_X"] != null)
				{
					label ="定位";
				}else{
					label ="详情";
				}
			}
			
			override public function set label(value:String):void
			{
				if(value == null || _label == value || data == null)
					return;
				removeEventListener(MouseEvent.CLICK,locate_clickHandler);
				removeEventListener(MouseEvent.CLICK,detail_clickHandler);
				//文档
				text =value;
				if(value == "定位")
				{
					addEventListener(MouseEvent.CLICK,locate_clickHandler);
				}else if(value == "详情"){
					addEventListener(MouseEvent.CLICK,detail_clickHandler);
				}
				_label =  super.label = value;
			}
			
			//定位
			protected function locate_clickHandler(event:MouseEvent):void
			{
				//隐藏面板
				var hideContainer:BaseDataEvent = new BaseDataEvent(BaseDataEvent.BASEDATA_HIDE_CONTAINER_PANEL);
				hideContainer.dispatch();
				
				//高亮显示选中要素，并显示详情
				getRelObjectDetailInfo();
			}
			
			//详情
			protected function detail_clickHandler(event:MouseEvent):void
			{
				if(queryType == ConstVO.QUERY_TYPE_REL_DOC)
				{
					var baseDataLinkDocPanel:BaseDataLinkDocPanel = new BaseDataLinkDocPanel();
					baseDataLinkDocPanel.selectIndex = 0;
					//设置精简模式，不显示缩略图
					baseDataLinkDocPanel.currentState = BaseDataLinkDocPanel.SIMPLIFY;
					baseDataLinkDocPanel.linkDataProvider =new ArrayCollection([data]);
					PopUpManager.addPopUp(baseDataLinkDocPanel,FlexGlobals.topLevelApplication as UIComponent,false);
				}
				else //if (queryType == ConstVO.QUERY_TYPE_PRO )
				{
					getRelObjectDetailInfo();
				}
			}
			
			private function getRelObjectDetailInfo():void
			{
				//高亮显示选中要素，并显示详情
				if(data != null)
				{
					var searchRequestData:SearchRequestData;
					//发送要素详情检索请求
					searchRequestData = new SearchRequestData();
					searchRequestData.objectCode = data["OBJ_CODE"];
					searchRequestData.middleTypeList =[data["MIDDLE_TYPE"]];
					searchRequestData.targetId = TargetIDConsts.LUCENE_LUCENE0010SURVEYSEARCH;
					var requestData:Object = {};
					requestData["parentData"] = data;
					requestData["searchRequestData"] = searchRequestData;
					requestData["layerName"] = ConstVO.BASEDATA_DETAIL_FEATURE_LAYER;
					var baseDataEvent:BaseDataEvent = new BaseDataEvent(BaseDataEvent.BASEDATA_GET_FEATURE_DETAIL);
					baseDataEvent.data = requestData;
					baseDataEvent.dispatch();
					
//					//发送要素高亮请求
//					searchRequestData = new SearchRequestData();
//					searchRequestData.targetId = TargetIDConsts.VECTOR_VECTOR0010SEARCH;
//					searchRequestData.objectCodeList = [data["OBJ_CODE"]];
//					searchRequestData.middleTypeList =[data["MIDDLE_TYPE"]];
//					var highLightEvent:MapCtrlEvent = new MapCtrlEvent(MapCtrlEvent.HIGH_LIGHT_FEATURE);
//					highLightEvent.data =searchRequestData;
//					highLightEvent.dispatch(); 
					
					modelLocator.baseDataVO.invokeCode = "0";
				}
			}
		]]>
	</fx:Script>
</s:DefaultGridItemRenderer>
