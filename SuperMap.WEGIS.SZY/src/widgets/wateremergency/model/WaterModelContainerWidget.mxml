<?xml version="1.0" encoding="utf-8"?>
<ns:WidgetBase xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   xmlns:ns="library://ns.supermap.com/flex/wegis/common"
			   xmlns:line="sm.wegis.szy.components.line.*"
			   xmlns:components="widgets.wateremergency.model.components.*"
			   width="100%" height="100%"
			   xmlns:chart="widgets.wateremergency.chart.*"
			   creationComplete="this_creationCompleteHandler(event)" >
	<fx:Script>
		<![CDATA[
			import com.adobe.cairngorm.control.CairngormEvent;
			import com.adobe.cairngorm.control.CairngormEventDispatcher;
			import com.supermap.web.core.Feature;
			import com.supermap.web.events.ViewBoundsEvent;
			import com.supermap.web.iServerJava6R.Recordset;
			import com.supermap.web.utils.Hashtable;
			import com.supermap.wegis.common.mappingEx.FeaturesLayerEx;
			import com.supermap.wegis.common.mappingEx.TiledDynamicRESTLayerEx;
			import com.supermap.wegis.common.utils.ColorGradient;
			import com.supermap.wegis.common.utils.DateUtilEx;
			
			import flash.utils.setTimeout;
			
			import mx.charts.HitData;
			import mx.charts.LegendItem;
			import mx.charts.chartClasses.IAxis;
			import mx.charts.chartClasses.Series;
			import mx.charts.events.LegendMouseEvent;
			import mx.charts.series.AreaSeries;
			import mx.charts.series.LineSeries;
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			import mx.formatters.DateFormatter;
			import mx.utils.ColorUtil;
			
			import sm.wegis.szy.events.QueryEvent;
			import sm.wegis.szy.events.SystemEvent;
			import sm.wegis.szy.events.TimeSliderEvent;
			import sm.wegis.szy.models.ApplicationModelLocator;
			import sm.wegis.szy.utils.CairngormEventClass;
			import sm.wegis.szy.utils.CairngormEventManager;
			import sm.wegis.szy.utils.ColorUtils;
			import sm.wegis.szy.utils.FeatureLayerUtil;
			import sm.wegis.szy.vo.ConstVO;
			import sm.wegis.szy.vo.ModelContainerShowVO;
			import sm.wegis.szy.vo.WSMethod;
			import sm.wegis.szy.vo.WaterModelParam;
			
			import spark.components.CheckBox;
			import spark.events.IndexChangeEvent;
			
			import widgets.wateremergency.chart.AreaChartDataRender;
			import widgets.wateremergency.chart.LineChartDataRender;
			import widgets.wateremergency.chart.LineSeriesEx;
			
			[Bindable]
			private var modelLocator:ApplicationModelLocator = ApplicationModelLocator.getInstance();
			
			public static const HIDE_STATE:String = "hideState";
			public static const BREAK_STATE:String = "breakState";
			public static const RIVER_STATE:String = "riverState";
			public static const POLLUTION_COMPARE_STATE:String = "pollutionCompareState";
			
			/**断面标识*/
			public static const BREAK_COVER:String = "BP";
			/**河道标识*/
			public static const RIVER_WAY:String = "RW";
			
			/**可对比方案列表*/
			[Bindable]
			private var compareSchemeList:ArrayCollection = null;
			
			/**断面对比方案列表*/
			[Bindable]
			private var DMcompareSchemeList:ArrayCollection = null;
			
			/**当前方案断面列表*/
			[Bindable]
			private var dmList:ArrayCollection = null;
			
			/**当前断面对象*/
			private var sameItem:Object = null;
			/**当前断面对象索引*/
			private var sameItemIndex:int = -1;
			
			/**不同方案，相同断面对比，提示文本字段*/
			private var toolTipField:String = "toolTip";
			
			[Bindable]
			private var targetsList:ArrayCollection;
			
			[Bindable]
			private var riverCompareMonth:ArrayCollection = new ArrayCollection([
				{label:"一月",value:1}
				,{label:"二月",value:2}
				,{label:"三月",value:3}
				,{label:"四月",value:4}
				,{label:"五月",value:5}
				,{label:"六月",value:6}
				,{label:"七月",value:7}
				,{label:"八月",value:8}
				,{label:"九月",value:9}
				,{label:"十月",value:10}
				,{label:"十一月",value:11}
				,{label:"十二月",value:12}
			]);
			
			private function clear():void
			{
				this.sameItem = null;
				this.sameItemIndex = -1;
				this.resetDmChart();
			}
			
			protected function this_creationCompleteHandler(event:FlexEvent):void
			{
				initEventListener();
				riverPollutionCompareInitHandler();
			}
			
			public function initEventListener():void{
				var eList:ArrayCollection = new ArrayCollection([
					[QueryEvent.QUERY_MODEL_RESULT_RESPONSE, queryModelResultResponseHandler],//模型计算的断面列表
					[QueryEvent.QUERY_COMPARE_LIST_RESPONSE, queryCompareListResponseHandler],//查询可对比方案列表
					[QueryEvent.QUERY_BREAK_CALC_RESULT_RESPONSE, queryBreakCalcResultResponseHandler],//查询断面计算结果
					[QueryEvent.QUERY_RIVER_CALC_RESULT_RESPONSE, queryRiverCalcResultResponseHandler],//查询河道计算结果
					[QueryEvent.QUERY_DM_PROFILE_RESPONSE, queryDmProfileResponseHandler],//查询断面地形剖面数据
					[QueryEvent.SHOW_MODEL_RESULT_WIDGET, showModelResultWidgetHandler], //显示当前断面河道结果面板
					[QueryEvent.QUERY_RIVER_COMPARE_CALC_RESULT_RESPONSE, queryRiverCompareHandler],//河道对比
					[QueryEvent.QUERY_BREAK_COMPARE_CALC_RESULT_RESPONSE, queryDMCompareHandler],//断面对比
					[SystemEvent.SYSTEM_RELOAD, systemReloadHandler]
				]);
				var eventObject:CairngormEventClass = new CairngormEventClass();
				CairngormEventManager.getInstance().attachEvent(eventObject.encode(eList));
			}
			
			//断面地形剖面数据
			private function queryDmProfileResponseHandler(event:CairngormEvent):void
			{
				var result:Object = event.data;
				if(result != null && result["success"]
					&& result["attributes"]["targetList"] 
					&& result["attributes"]["targetList"] is Array
					&& (result["attributes"]["targetList"] as Array).length==2)
				{
					if (dmProfileGroup != null) {
						dmProfileGroup.enabled = true;
					}
					decodeDmProfileData(result);
				}
			}
			
			//断面剖面数据解码
			private function decodeDmProfileData(dpData:Object):void
			{
				var tp:Object = dpData["attributes"]["targetList"][0];//地形剖面数据
				var wp:Object = dpData["attributes"]["targetList"][1];//水位时相数据
				
				//绘制剖面图形
				var tpscs:SolidColorStroke = new SolidColorStroke(tp["color"]);
				dmTerrainProfile.setStyle("areaStroke", tpscs);
				var tpsc:SolidColor = new SolidColor(tp["color"]);
				dmTerrainProfile.setStyle("areaFill", tpsc);
				dmTerrainProfile.displayName = "地形剖面";
				dmTerrainProfile.dataProvider = new ArrayCollection(tp["nodeList"]);
				
				if ((wp["nodeList"] as Array).length == 0 || (tp["nodeList"] as Array).length == 0) {
					return;
				}
				//绘制水位图形,默认显示第一个时间的水位
				var wpValue:Number = wp["nodeList"][0]["altitude"];//第一时间水位值
				var minDistance:Number = tp["nodeList"][0]["distance"];//最近
				var maxDistance:Number = tp["nodeList"][tp["nodeList"].length - 1]["distance"];//最远
				
				dmHorizontalAxis.minimum = minDistance;
				dmHorizontalAxis.maximum = maxDistance;
				
				//获取剖面最低、最高高程 dmVerticalAxis
				var minAltitude:Number = Number.MAX_VALUE;
				var maxAltitude:Number = Number.MIN_VALUE;
				for each(var item:Object in tp["nodeList"]) {
					if (minAltitude >item.altitude) {
						minAltitude = item.altitude;
					}
					if (maxAltitude <item.altitude) {
						maxAltitude = item.altitude;
					}
				}
				//最大，最小，上下浮动10%
				minAltitude = minAltitude - minAltitude*0.1;
				maxAltitude = maxAltitude + maxAltitude*0.1;
				dmVerticalAxis.minimum = minAltitude;
				dmVerticalAxis.maximum = maxAltitude;
				
				modelLocator.waterModelParam.wpValue = wpValue;
				modelLocator.waterModelParam.minDistance = minDistance;
				modelLocator.waterModelParam.maxDistance = maxDistance;
				
				var wpscs:SolidColorStroke = new SolidColorStroke(wp["color"]);
				dmWaterPosition.setStyle("areaStroke", wpscs);
				var wpsc:SolidColor = new SolidColor(wp["color"]);
				dmWaterPosition.setStyle("areaFill", wpsc);
				dmWaterPosition.displayName = "水位";
				dmWaterPosition.dataProvider = new ArrayCollection(rewriteWaterPositionData(minDistance,maxDistance,wpValue));
				
				//初始化时间轴
				var wpTimeData:Array = wp["nodeList"];
				modelLocator.waterModelParam.wpTimeData = wpTimeData;
				modelLocator.waterModelParam.wpIndex = 0;
				dmTimeSlider.minimum = 0;
				dmTimeSlider.maximum = wpTimeData.length - 1;
				dmTimeLabel.text = wpTimeData[0]["date"];
				dmWpLabel.text = Number(wpTimeData[0]["altitude"]).toFixed(2);
				
				//播放
				updateWaterLevelHandler();
			}
			
			//将断面水位数据转化为面统计图数据
			private function rewriteWaterPositionData(minDistance:Number, maxDistance:Number, wpValue:Number):Array
			{
				var wpArray:Array = [];
				wpArray.push({"distance": minDistance, "altitude": 0});
				wpArray.push({"distance": minDistance, "altitude": wpValue});
				wpArray.push({"distance": maxDistance, "altitude": wpValue});
				wpArray.push({"distance": maxDistance, "altitude": 0});
				return wpArray;
			}
			
			
			
			//查询可对比方案列表
			private function queryCompareListResponseHandler(event:CairngormEvent):void
			{
				clear();
				
				compareSchemeList = null;
				var result:Object = event.data;
				if(result != null && result["success"] 
					&& result["attributes"] 
					&& result["attributes"]["targetList"] is Array)
				{
					compareSchemeList = new ArrayCollection(result["attributes"]["targetList"]);
					//断面对比，需要增加当前方案
					var currentPlan:Object = {planNm:"当前方案"};
					var temp:ArrayCollection = new ArrayCollection(compareSchemeList.toArray());
					temp.addItemAt(currentPlan,0);
					DMcompareSchemeList = temp;
				}
			}
			
			//获取单个水模型方案结果
			private function queryModelResultResponseHandler(event:CairngormEvent):void
			{
				dmList = null;
				var result:Object = event.data;
				if (result != null && result.success == true && result.attributes && result.attributes.attributes is Array) {
					var tempCol:Array = result.attributes.attributes as Array;
					var sectionCol:Array = [];
					if(tempCol != null && tempCol.length > 0)
					{
						for each(var section:Object in tempCol)
						{
							if(section != null && section["sectionName"] != null && section.type == "差值")
							{
								sectionCol.push(section);
							}
						}
					}
					dmList = new ArrayCollection(sectionCol);
				}
			}
			
			//响应河道计算结果
			private function queryRiverCalcResultResponseHandler(event:CairngormEvent):void
			{
				var result:Object = event.data;
				var datas:Array = [];
				if (result is Array) {
					datas = result as Array;
				} else if (result is Object) {
					datas = [result];
				}
				if (datas.length > 0) {
					for each(var item:Object in datas) {
						if(item != null && item["success"] && item["attributes"] && item["attributes"]["result"] is Array)
						{
							var saCol:Array = item["attributes"]["result"] as Array;
							if (saCol != null && saCol.length > 0) 
							{
								//此处动态创建统计图序列，序列数[1-12]
								//设置Y轴名称 
								this.hdVerticalAxis.title = targetRwList.selectedItem.title;
								var sa:Array = [];
								for (var index:int = 0 ; index < saCol.length ;index++)
								{
									var saData:Object = saCol[index];
									var chartType:String = saData["type"];
									if(chartType == "LineChart")
									{
										var ls:LineSeriesEx = null;
										if (hdChart.series != null && index in hdChart.series && hdChart.series[index] is LineSeriesEx) {
											ls = hdChart.series[index] as LineSeriesEx;
										}
										if (ls == null) {
											ls = new LineSeriesEx();
										}
										ls.name = saData["label"];
										ls.xField = saData["xField"];
										ls.yField = saData["yField"];
										ls.setStyle("form", "curve");
										ls.setStyle("showDataEffect", slide);
										var scs:SolidColorStroke = new SolidColorStroke(saData["color"]);
										ls.setStyle("lineStroke", scs);
										//										var cf:ClassFactory = new ClassFactory(LineChartDataRender);
										//										ls.setStyle("itemRenderer", cf);
										ls.displayName = saData["label"];
										var temp:Array = saData["nodeList"];
										ls.dataProvider = ls.originalDataProvider = new ArrayCollection(temp);
										sa.push(ls);
									}
									else if(chartType == "AreaChart")
									{
										//略
									}
								}
								this.hdChart.series = sa;
							}
						}
					}
				}else {
					this.hdChart.series = [];
				}
			}
			
			//响应断面计算结果
			private function queryBreakCalcResultResponseHandler(event:CairngormEvent):void
			{
				var result:Object = event.data;
				var index:int = 0;
				var saCol:Array = [];
				var saData:Object;
				var serises:Array = [];
				//				if (targetDpList.selectedIndex != 4){
				if (result is Array){
					for each(var item:Object in result) {
						saCol.push(item.attributes);
					}
				}
				if (result.success == true) 
				{
					if(result.attributes) 
					{ 
						if (result.attributes.targetList)
						{
							if (result.attributes.targetList is Array) {
								saCol = result.attributes.targetList as Array;
							} 
						}else if(result.attributes is Object)
						{
							saCol = [result.attributes];
						}
					}
				}
				if (saCol.length > 0) 
				{
					//设置Y轴名称 
					this.verticalAxis.title = targetDpList.selectedItem.title;
					//此处动态创建统计图序列，序列数[1-2]
					var sa:Array = [];
					for (index = 0 ; index < saCol.length ; index++)
					{
						saData = saCol[index];
						var chartType:String = saData["type"];
						if(chartType == "LineChart")
						{
							var ls:LineSeriesEx = null;
							if (dmChart.series != null && index < dmChart.series.length && dmChart.series[index] is LineSeriesEx) {
								ls = dmChart.series[index] as LineSeriesEx;
							}
							if (ls == null) {
								ls = new LineSeriesEx();
							}
							ls.name = saData["label"];
							ls.xField = saData["xField"];
							ls.yField = saData["yField"];
							ls.setStyle("form", "curve");
							ls.setStyle("showDataEffect", slide);
							var scs:SolidColorStroke = new SolidColorStroke(saData["color"]);
							ls.setStyle("lineStroke", scs);
							//	var cf:ClassFactory = new ClassFactory(LineChartDataRender);
							//	ls.setStyle("itemRenderer", cf);
							ls.displayName = saData["label"];
							var temp:Array = saData["nodeList"];
							ls.dataProvider = ls.originalDataProvider = new ArrayCollection(temp);
							serises.push(ls);
						}
					}
					dmChart.series = serises;
				} 
				//				} else if (targetDpList.selectedIndex == 4) {
				//					if (result is Array){
				//						saCol = result;
				//					} else {
				//						saCol = [result];
				//					}
				//					dmPollutionTypeGroup.removeAllElements();
				//					for (index = 0 ; index < saCol.length ; index++){
				//						saData = saCol[index];
				//						var checkBox:CheckBox = new CheckBox();
				//						checkBox.selected = true;
				//						checkBox.label = saData.label;
				//						checkBox.id = saData.label;
				//						checkBox.addEventListener(Event.CHANGE, lineSelectChangeHandler);
				//						dmPollutionTypeGroup.addElement(checkBox);
				//					}
				//				}
			}
			
			private function showModelResultWidgetHandler(event:CairngormEvent):void
			{
				var modelShowVO:ModelContainerShowVO =  event.data as  ModelContainerShowVO;
				panel.title = modelShowVO.title;
				this.currentState = modelShowVO.state;
				if (this.currentState == BREAK_STATE) {
					breakBTB.selectedIndex = 0;
				} else if (this.currentState == RIVER_STATE) {
					riverBTB.selectedIndex = 0;
				}
				if (modelLocator.waterModelParam.isHave == true) {
					targetsList = new ArrayCollection([
						{label:"水位",value:1,title:"水位[m]"}, {label:"水深",value:2,title:"水深[m]"},
						{label:"流量",value:3,title:"流量[m³/s]"},{label:"流速",value:4,title:"流速[m/s]"},
						{label:"污染物浓度",value:5,title:"污染物浓度[mg/L]"}]);
				} else {
					targetsList = new ArrayCollection([
						{label:"水位",value:1,title:"水位[m]"}, {label:"水深",value:2,title:"水深[m]"},
						{label:"流量",value:3,title:"流量[m³/s]"},{label:"流速",value:4,title:"流速[m/s]"}]);	
				}
				//请求剖面展示数据
				if (dmProfileGroup != null){
					this.startDmWaterLevelSimulate();
				}
			}
			
			
			protected function closeBt_clickHandler(event:MouseEvent):void
			{
				this.currentState = HIDE_STATE;
			}
			
			//河道污染物浓度对比展示
			protected function riverPollutionCompareCloseBt_clickHandler(event:MouseEvent):void
			{
				this.currentState = RIVER_STATE;
			}
			
			//点击查询断面计算结果
			private function queryBt_clickHandler():void
			{
				var waterModelparam:WaterModelParam = modelLocator.waterModelParam;
				waterModelparam.method = getQueryMethodHandler(targetDpList, BREAK_COVER);
				var queryEvent:QueryEvent = new QueryEvent(QueryEvent.QUERY_BREAK_CALC_RESULT);
				queryEvent.dispatch();
			}
			
			//根据选择指标类型，获取后台查询方法,默认为断面
			private function getQueryMethodHandler(hostDdl:DropDownList, methodType:String=BREAK_COVER):String
			{
				var selectItem:Object = null;
				if(methodType == BREAK_COVER)//断面
				{
					selectItem = hostDdl.selectedItem;
					switch(selectItem["value"]) {
						case 1:
							return WSMethod.GetWaterDMPositionData;
						case 2:
							return WSMethod.GetWaterDMDepthData;
						case 3:
							return WSMethod.GetWaterDMFlowData;
						case 4:
							return WSMethod.GetWaterDMSpeedData;
						case 5:
							return WSMethod.GetWaterDMDensitySource;//断面污染物浓度目前还未实现
					}
				}
				else if(methodType == RIVER_WAY)//河道
				{
					selectItem = hostDdl.selectedItem;
					switch(selectItem["value"]) {
						case 1:
							return WSMethod.GetWaterHDPositionData;
						case 2:
							return WSMethod.GetWaterHDDepthData;
						case 3:
							return WSMethod.GetWaterHDFlowData;
						case 4:
							return WSMethod.GetWaterHDSpeedData;
						case 5:
							return WSMethod.GetWaterHDDensitySource;//河道污染物浓度目前还未实现
					}
				}
				return "";
			}
			
			//系统重新加载
			public function systemReloadHandler(event:CairngormEvent):void
			{
				
			}
			
			//通过的图例控制
			protected function hd_wpLegend_itemClickHandler(event:LegendMouseEvent):void
			{
				var currentLegendItem:LegendItem = event.item as LegendItem;
				var currentChartItem:LineSeries = event.item.source as LineSeries;
				var currentChartItem0:AreaSeries = event.item.source as AreaSeries;
				if(currentLegendItem != null && currentChartItem != null)
				{
					currentChartItem.visible = currentChartItem.visible?false:true;
					var lc:Number=SolidColorStroke(currentChartItem.getStyle("lineStroke")).color;
					currentChartItem.setStyle("color", currentChartItem.visible?lc:0x959695);
				}
				else if(currentChartItem0 != null && currentChartItem0 != null)
				{
					currentChartItem0.visible = currentChartItem0.visible?false:true;
					var ac:Number=SolidColorStroke(currentChartItem0.getStyle("areaStroke")).color;
					currentChartItem0.setStyle("color", currentChartItem0.visible?ac:0x959695);
				}
			}
			
			//将X轴显示转化为具体的日期格式
			private function dateParseFunction(s:String):Date { 
				var a:Array = s.split("-");
				var newDate:Date = new Date(a[0],a[1]-1,a[2]);
				return newDate;
			}
			
			//X轴时间显示格式
			private function dateFormatFunction(labelValue:Date, previousValue:Object, axis:IAxis):String
			{ 
				var dateFormatter:DateFormatter = new DateFormatter();   
				dateFormatter.formatString = "MM-DD";   
				var dateValue:String= dateFormatter.format(labelValue);    
				return dateValue;
			}
			
			//将X轴显示转化为具体的日期格式
			private function dateParseFunction0(s:String):Date { 
				var a:Array = s.split("-");
				var b:Array = a[2].split(" ");
				var c:Array = b[1].split(":");
				var newDate:Date = new Date(a[0],a[1]-1,b[0], c[0], c[1]);
				return newDate;
			}
			
			//断面--地形剖面统计图
			private function terrainProfileDataTipFunction (hitData:HitData):String { 
				var cntData:Object = hitData.item;
				
				var cnt:int = hitData.item[hitData.chartItem.element["yField"]];
				var displayName:String = hitData.chartItem.element["displayName"];
				return "高程:" + cntData[hitData.chartItem.element["yField"]] + "<br>"+"距离:"+ cntData[hitData.chartItem.element["xField"]];
			}
			
			//断面通用的显示描述
			private function dmDataTipFunction (hitData:HitData):String { 
				var cntData:Object = hitData.item;
				
				var cnt:int = hitData.item[hitData.chartItem.element["yField"]];
				var displayName:String = targetDpList.selectedItem.title;
				var tipStr:String = displayName+ ":" + cntData[hitData.chartItem.element["yField"]] + "<br>"+"时间:";
				if (dmCompareSchemeList.selectedIndex != 0){
					tipStr += cntData[toolTipField];
				} else {
					tipStr += cntData[hitData.chartItem.element["xField"]];
				}
				return tipStr;
			}
			
			//河道通用的显示描述
			private function hdDataTipFunction (hitData:HitData):String { 
				var cntData:Object = hitData.item;
				
				var cnt:int = hitData.item[hitData.chartItem.element["yField"]];
				var displayName:String = targetRwList.selectedItem.title;
				return displayName+ ":" + cntData[hitData.chartItem.element["yField"]] + "<br>"+"距离[m]:"+ cntData[hitData.chartItem.element["xField"]];
			}
			
			protected function queryRwBt_clickHandler(event:MouseEvent):void
			{
				var waterModelparam:WaterModelParam = modelLocator.waterModelParam;
				waterModelparam.method = getQueryMethodHandler(targetRwList, RIVER_WAY);
				var queryEvent:QueryEvent = new QueryEvent(QueryEvent.QUERY_RIVER_CALC_RESULT);
				queryEvent.dispatch();
			}
			
			//断面统计图图例
			protected function targetDpList_changeHandler(event:IndexChangeEvent):void
			{
				// TODO Auto-generated method stub
				this.dmChart.series = [];
				//设置Y轴名称 
				this.verticalAxis.title = targetDpList.selectedItem.title;
				
				this.dmChart.clearChartGraphic();
			}
			
			//河道统计图图例
			protected function targetRwList_changeHandler(event:IndexChangeEvent):void
			{
				// TODO Auto-generated method stub
				this.hdChart.series = [];
				//设置Y轴名称 
				this.hdVerticalAxis.title = targetRwList.selectedItem.title;
				
				this.hdChart.clearChartGraphic();
			}
			
			//重置断面对比图表内容
			private function resetDmChart():void
			{
				if(this.dmCompareList)
				{
					// TODO Auto-generated method stub
					this.dmCompareChart.series = [];
					//设置Y轴名称 
					this.verticalCompareAxis.title = targetDpCompareList.selectedItem.title;
					
					this.dmCompareChart.clearChartGraphic();
				}
			}
			
			//断面对比指标选择
			protected function targetDpCompareList_changeHandler(event:IndexChangeEvent):void
			{
				// TODO Auto-generated method stub
				this.resetDmChart();
			}
			
			//断面对比方案选择
			protected function dmCompareSchemeList_changeHandler(event:IndexChangeEvent):void
			{
				// TODO Auto-generated method stub
				this.resetDmChart();
				var schemeItem:Object = this.dmCompareSchemeList.selectedItem;
				if(schemeItem != null)
				{
					if(dmList && dmList.length > 0)
					{
						for each (var tempItem:Object in dmList)
						{
							if(tempItem && tempItem["sectionCode"] == modelLocator.waterModelParam.dmId)
							{
								sameItem = tempItem;//定位下拉列表中与当前断面相同的断面
								sameItemIndex = dmList.getItemIndex(tempItem);
								break;
							}
						}
					}
					
					//同一个方案，对比不同的断面，此处断面可选
					if(schemeItem["planId"] == modelLocator.waterModelParam.planId)
					{
						dmList.removeItemAt(sameItemIndex);
						this.dmCompareList.enabled = true;
						this.dmCompareList.selectedIndex = 0;
					}
					else//不同的方案对比同一个断面，此处断面不可选
					{
						dmList.addItemAt(sameItem,sameItemIndex);
						this.dmCompareList.selectedItem = sameItem;
						this.dmCompareList.enabled = false;
					}
				}
			}
			
			//断面对比断面选择
			protected function dmCompareList_changeHandler(event:IndexChangeEvent):void
			{
				// TODO Auto-generated method stub
				this.resetDmChart();
			}
			
			//执行断面对比
			private var queryCompareDMCalc:Boolean = false;
			private var DMCompareResult:Object = {};
			protected function queryCompareBt_clickHandler(event:MouseEvent):void
			{
				var waterModelparam:WaterModelParam = modelLocator.waterModelParam;
				waterModelparam.method = getQueryMethodHandler(targetDpCompareList, BREAK_COVER);
				//设置flag，标识开始请求数据
				queryCompareDMCalc = false;
				var queryEvent:QueryEvent = new QueryEvent(QueryEvent.QUERY_BREAK_COMPARE_CALC_RESULT);
				queryEvent.data = waterModelparam;
				queryEvent.dispatch();
			}
			
			private function queryDMCompareHandler(event:CairngormEvent):void
			{
				var result:Object = event.data;
				var saData:Array = [];
				if (queryCompareDMCalc == false){
					if (result.success == true && result.attributes && result.attributes.targetList &&  result.attributes.targetList is Array) {
						if ((result.attributes.targetList as Array).length == 2) {
							DMCompareResult.currentPlan =  result.attributes.targetList[0];
						}
					}
					if (result is Array)
					{
						for each(var item:Object in result)
						{
							saData.push(item.attributes);
						}
						DMCompareResult.currentPlan =  saData;
					}
					queryCompareDMCalc = true;
					
					var currentWaterModelparam:WaterModelParam = modelLocator.waterModelParam;
					
					var waterModelparam:WaterModelParam = new WaterModelParam();
					waterModelparam.method = getQueryMethodHandler(targetDpCompareList, BREAK_COVER);
					//当前方案，不同断面对比
					if (dmCompareSchemeList.selectedIndex == 0) {
						waterModelparam.planId = currentWaterModelparam.planId;
						waterModelparam.dmId = dmCompareList.selectedItem.sectionCode;
					}else{
						waterModelparam.planId = dmCompareSchemeList.selectedItem.planId;
						waterModelparam.dmId = currentWaterModelparam.dmId;
					}
					var queryEvent:QueryEvent = new QueryEvent(QueryEvent.QUERY_BREAK_COMPARE_CALC_RESULT);
					queryEvent.data = waterModelparam;
					queryEvent.dispatch();
				} else if (queryCompareDMCalc == true){
					if (result.success == true && result.attributes && result.attributes.targetList &&  result.attributes.targetList is Array) {
						if ((result.attributes.targetList as Array).length == 2) {
							DMCompareResult.comparePlan =  result.attributes.targetList[0];
						}
					}
					
					if (result is Array)
					{
						for each(var item0:Object in result)
						{
							saData.push(item0.attributes);
						}
						DMCompareResult.comparePlan =  saData;
					}
					
					//对不同方案，相同断面进行处理
					if (dmCompareSchemeList.selectedIndex != 0) {
						for each(var item:Object in DMCompareResult.currentPlan.nodeList){
							item[toolTipField] = item.time;
							var times:Array = item.time.split("-");
							times["0"] = "1900"; // 年份，我自己指定的，主要是让两组数据，年份相同
							item.time = times.join("-");
						}
						for each(var item:Object in DMCompareResult.comparePlan.nodeList){
							item[toolTipField] = item.time;
							var times:Array = item.time.split("-");
							times["0"] = "1900";
							item.time = times.join("-");
						}
					}
					//显示对比chart
					showDMCompareChart();
				}
			}
			
			/**显示对比chart*/
			private function showDMCompareChart():void
			{
				//显示当前方案的数据
				//设置Y轴名称 
				this.verticalCompareAxis.title = targetDpCompareList.selectedItem.title;
				
				
				var saData:Object;
				var saDatas:Array = [];
				var sa:Array = [];
				var month:int;
				var label:String;
				
				if (DMCompareResult.currentPlan is Array){
					dmCompareType.removeAllElements();
					for each(var item:Object in DMCompareResult.currentPlan){
						var checkBox:CheckBox = new CheckBox();
						checkBox.name = item.label;
						checkBox.selected = true;
						checkBox.label = item.label;
						checkBox.addEventListener(Event.CHANGE, lineSelectChangeHandler);
						dmCompareType.addElement(checkBox);
						saDatas.push(item);
					}
				} else {
					saDatas.push(DMCompareResult.currentPlan);
				}
				
				if (DMCompareResult.comparePlan is Array){
					for each(var item0:Object in DMCompareResult.comparePlan){
						saDatas.push(item0);
					}
				} else {
					saDatas.push(DMCompareResult.comparePlan);
				}
				
				for (var index:int = 0 ; index < saDatas.length ; index++) {
					saData = saDatas[index];
					var ls:LineSeriesEx;
					if(saData["type"] == "LineChart")
					{
						if (dmCompareChart.series.length > index) {
							ls = dmCompareChart.series[index] as LineSeriesEx;
						} else {
							ls = new LineSeriesEx();
						}
						ls.name = saData["label"];
						ls.xField = saData["xField"];
						ls.yField = saData["yField"];
						ls.setStyle("form", "curve");
						ls.setStyle("showDataEffect", slide);
						//						var scs:SolidColorStroke = new SolidColorStroke(saData["color"]);
						var scs:SolidColorStroke = new SolidColorStroke();
						if (index < modelLocator.systemInfo.colors.length) {
							scs.color = modelLocator.systemInfo.colors[index];
						}
						ls.displayName = saData.schemeName + saData["sectionName"];
						ls.setStyle("lineStroke", scs);
						//						var cf:ClassFactory = new ClassFactory(LineChartDataRender);
						//						ls.setStyle("itemRenderer", cf);
						var temp:Array = saData["nodeList"];
						ls.dataProvider = ls.originalDataProvider = new ArrayCollection(temp);
						sa.push(ls);
					}
				}
				dmCompareChart.series = sa;
			}
			
			private function lineSelectChangeHandler(event:Event):void
			{
				var checkBox:CheckBox = event.currentTarget as CheckBox;
				var name:String = checkBox.name;
				for each(var series:Series in  dmCompareChart.series) {
					if (series.name.search(name) != -1) {
						series.visible = checkBox.selected;
					}
				}
			}
			
			
			protected function riverTargetRwList_valueCommitHandler(event:FlexEvent):void
			{
				mapCompare.visible = mapCompare.includeInLayout = false;
				var dropDownList:DropDownList = event.currentTarget as DropDownList;
				if (dropDownList.selectedIndex == 4){
					mapCompare.visible = mapCompare.includeInLayout = true;
				}
			}
			
			private var riverCompareResult:Object = {};
			private var queryCompareRiverCalc:Boolean = false;
			private var clickButton:Button;
			//先请求当前方案的河道对应计算指标计算结果
			protected function riverQueryRwBt_clickHandler(event:MouseEvent):void
			{
				clickButton = event.currentTarget as Button;
				if (clickButton == mapCompare)
				{
					//点击河道污染物浓度对比
					this.currentState = POLLUTION_COMPARE_STATE;
				}
				var waterModelparam:WaterModelParam = modelLocator.waterModelParam;
				waterModelparam.method = getQueryMethodHandler(riverTargetRwList, RIVER_WAY);
				
				//设置flag，标识开始请求数据
				queryCompareRiverCalc = false;
				riverCompareMonthDpList.enabled = false;
				var queryEvent:QueryEvent = new QueryEvent(QueryEvent.QUERY_RIVER_COMPARE_CALC_RESULT);
				queryEvent.data = waterModelparam;
				queryEvent.dispatch();
			}
			
			private function queryRiverCompareHandler(event:CairngormEvent):void
			{
				var result:Object = event.data;
				if (queryCompareRiverCalc == false){
					if (result.success == true) {
						riverCompareResult.currentPlan = result.attributes.result;
					}
					queryCompareRiverCalc = true;
					var waterModelparam:WaterModelParam = new WaterModelParam();
					waterModelparam.method = getQueryMethodHandler(riverTargetRwList, RIVER_WAY);
					waterModelparam.planId = riverCompareSchemeList.selectedItem.planId;
					var queryEvent:QueryEvent = new QueryEvent(QueryEvent.QUERY_RIVER_COMPARE_CALC_RESULT);
					queryEvent.data = waterModelparam;
					queryEvent.dispatch();
				} else if (queryCompareRiverCalc == true){
					if (result.success == true) {
						riverCompareResult.comparePlan = result.attributes.result;
					}
					riverCompareMonthDpList.enabled = true;
					//显示对比chart
					if (clickButton == riverQueryRwBt) {
						showRiverCompareChart();
					} else {
						//处理数据，供Hslider使用
					}
				}
			}
			
			/**处理污染物浓度地图对比，时间轴数据，取两个交集*/
			private function resolveHsliderTime():void
			{
				var saData:Object;
				var times:Hashtable = new Hashtable();
				var month:int;
				var label:String;
				for each(saData in riverCompareResult.currentPlan)
				{
					label =saData["label"];
					month = -1;
					if (label.split("-").length == 2){
						month = parseInt(label.split("-")[1]);
					}
					times.add(month,month);
				}
				
				//遍历对比方案的数据
				for each(saData in riverCompareResult.comparePlan)
				{
					label =saData["label"];
					month = -1;
					if (label.split("-").length == 2){
						month = parseInt(label.split("-")[1]);
					}
					if (times.find(month) == null) {
						times.add(month,month);
					}
				}
				
				var months:Array = times.getKeySet();
				months.sort(Array.NUMERIC);
				
			}
			
			/**显示对比chart*/
			private function showRiverCompareChart():void
			{
				//设置Y轴名称 
				this.riverVerticalAxis.title = riverTargetRwList.selectedItem.title;
				var selectMonth:int = riverCompareMonthDpList.selectedItem.value;
				//显示当前方案的数据
				var saData:Object;
				var saDatas:Array = [];
				var sa:Array = [];
				var month:int;
				var label:String;
				for each(saData in riverCompareResult.currentPlan)
				{
					label =saData["label"];
					if (label != null) {
						month = -1;
						if (label.split("-").length == 2){
							month = parseInt(label.split("-")[1]);
						}
						if (month == selectMonth) {
							saDatas.push(saData);
							break;
						}
					}
				}
				
				//遍历对比方案的数据
				for each(saData in riverCompareResult.comparePlan)
				{
					label =saData["label"];
					if (label != null) {
						month = -1;
						if (label.split("-").length == 2){
							month = parseInt(label.split("-")[1]);
						}
						if (month == selectMonth) {
							saDatas.push(saData);
							break;
						}
					}
				}
				for (var index:int = 0 ; index < saDatas.length ; index++) {
					saData = saDatas[index];
					var ls:LineSeriesEx;
					if(saData["type"] == "LineChart")
					{
						if (riverCompareChart.series.length > index) {
							ls = riverCompareChart.series[index] as LineSeriesEx;
						} else {
							ls = new LineSeriesEx();
						}
						ls.name = saData["label"];
						ls.xField = saData["xField"];
						ls.yField = saData["yField"];
						ls.setStyle("form", "curve");
						ls.setStyle("showDataEffect", slide);
						//var scs:SolidColorStroke = new SolidColorStroke(saData["color"]);
						var scs:SolidColorStroke = null;
						if(index == 0)
						{
							scs = new SolidColorStroke(0xFF0000);
							ls.displayName =  saData["schemeName"];
						}
						else
						{
							scs = new SolidColorStroke(0x0000FF);
							ls.displayName = saData["schemeName"];
						}
						ls.setStyle("lineStroke", scs);
						//						var cf:ClassFactory = new ClassFactory(LineChartDataRender);
						//						ls.setStyle("itemRenderer", cf);
						//ls.displayName = saData["schemeName"];
						var temp:Array = saData["nodeList"];
						ls.dataProvider = ls.originalDataProvider = new ArrayCollection(temp);
						sa.push(ls);
					}
				}
				riverCompareChart.series = sa;
			}
			
			protected function riverCompareMonthDpList_changeHandler(event:IndexChangeEvent):void
			{
				showRiverCompareChart();
			}
			
			//河道计算结果导出
			protected function exportRwBt_clickHandler(event:MouseEvent):void
			{
				var requestParam:WaterModelParam = new WaterModelParam();
				requestParam.planId =  modelLocator.waterModelParam.planId;
				requestParam.jisuanid = getExportCalcTypeHandler(targetRwList);
				var queryEvent:QueryEvent = new QueryEvent(QueryEvent.EXPORT_QUERY_RIVER_CALC_RESULT);
				queryEvent.data = requestParam;
				queryEvent.dispatch();
			}
			
			private function getExportCalcTypeHandler(hostDdl:DropDownList):String
			{
				var selectItem:Object = null;
				selectItem = hostDdl.selectedItem;
				switch(selectItem["value"]) {
					case 1:
						return ConstVO.WaterLevel;
					case 2:
						return ConstVO.WaterDepth;
					case 3:
						return ConstVO.WaterQuality;
					case 4:
						return ConstVO.WaterFlow;
					case 5:
						return "";//断面污染物浓度目前还未实现
				}
				return "";
			}
			
			//断面计算结果导出
			protected function dmExportBt_clickHandler(event:MouseEvent):void
			{
				var requestParam:WaterModelParam = new WaterModelParam();
				requestParam.planId =  modelLocator.waterModelParam.planId;
				requestParam.dmId = modelLocator.waterModelParam.dmId;
				requestParam.jisuanid = getExportCalcTypeHandler(targetDpList);
				var queryEvent:QueryEvent = new QueryEvent(QueryEvent.EXPORT_QUERY_DM_CALC_RESULT);
				queryEvent.data = requestParam;
				queryEvent.dispatch();
			}
			
			protected function dmCompareSchemeList_valueCommitHandler(event:FlexEvent):void
			{
				var dropdownList:DropDownList = event.currentTarget as DropDownList;
				dmCompareList.enabled = true;
				//选择的是非当前方案，断面设置为当前断面id------不同方案，相同断面比较
				if (dropdownList.selectedIndex != 0 && dropdownList.selectedIndex != -1) {
					for each(var item:Object in dmCompareList.dataProvider){
						if (item.sectionCode == modelLocator.waterModelParam.dmId) {
							dmCompareList.selectedItem = item;
							dmCompareList.enabled = false;
							break;
						}
					}
				}
			}
			
			//断面地形剖面数据
			private function dmProfileDataTipFunc(val:String):String
			{
				if(modelLocator.waterModelParam.wpTimeData != null 
					&& modelLocator.waterModelParam.wpTimeData.length > 0)
				{
					return "当前日期: " + modelLocator.waterModelParam.wpTimeData[val]["date"];
				}
				return "";
			}
			
			//开始断面地形水位推演
			private var playDMProfile:Boolean = false;
			protected function dmStartBt_clickHandler(event:MouseEvent):void
			{
				if (playDMProfile == false) {
					dmStartBt.label = "暂停";
					playDMProfile = true;
					updateWaterLevelHandler();
				} else {
					dmStartBt.label = "播放";
					playDMProfile = false;
				}
			}
			
			//停止断面地形水位推演
			protected function dmStopBt_clickHandler(event:MouseEvent):void
			{
				playDMProfile = false;
				dmStartBt.label = "播放";
				dmTimeSlider.value = dmTimeSlider.minimum;
			}
			
			private function startDmWaterLevelSimulate():void
			{
				var queryEvent:QueryEvent = new QueryEvent(QueryEvent.QUERY_DM_PROFILE);
				queryEvent.dispatch();
				dmProfileGroup.enabled = false;
			}
			
			protected function dmTimeSlider_changeHandler(event:Event):void
			{
				updateWaterLevelHandler();
			}
			
			private function updateWaterLevelHandler():void
			{
				var currentItem:Object = modelLocator.waterModelParam.wpTimeData[dmTimeSlider.value];
				dmTimeLabel.text = currentItem["date"];
				dmWpLabel.text = Number(currentItem["altitude"]).toFixed(2);
				modelLocator.waterModelParam.wpValue = Number(dmWpLabel.text );
				modelLocator.waterModelParam.wpIndex = dmTimeSlider.value;
				//更新水位统计图
				dmWaterPosition.dataProvider = new ArrayCollection(rewriteWaterPositionData(modelLocator.waterModelParam.minDistance,
					modelLocator.waterModelParam.maxDistance,modelLocator.waterModelParam.wpValue));
				if (playDMProfile == true ) {
					dmTimeSlider.value += dmTimeSlider.stepSize;
					setTimeout(updateWaterLevelHandler, 1000);
					if (dmTimeSlider.value == dmTimeSlider.maximum) {
						playDMProfile = false;
						dmStartBt.label = "播放";
						dmTimeSlider.value = dmTimeSlider.minimum;
					}
				}
			}
			
			protected function riverPollutionCompareInitHandler():void
			{
				var baseMapLayer:TiledDynamicRESTLayerEx;
				var waterResourceLayer:TiledDynamicRESTLayerEx;
				//添加两个地图图层
				baseMapLayer = new TiledDynamicRESTLayerEx();
				baseMapLayer.layerType = 0
				baseMapLayer.layerIndex = 1;
				baseMapLayer.url = modelLocator.baseMapInfo.baseVectorMapUrl;
				baseMapLayer.bounds = modelLocator.systemInfo.layerBounds;
				currentPlanMap.addLayer(baseMapLayer);
				
				waterResourceLayer = new TiledDynamicRESTLayerEx();
				waterResourceLayer.layerType = 1;
				waterResourceLayer.layerIndex = 1;
				waterResourceLayer.transparent = true;
				waterResourceLayer.layersID = modelLocator.systemInfo.lastLayerIds;
				waterResourceLayer.url = modelLocator.baseMapInfo.waterResourceVectorMapUrl;
				currentPlanMap.addLayer(waterResourceLayer);
				
				currentPlanMap.resolutions = modelLocator.mapCtrl.resolutions;
				
				var featuresLayer:FeaturesLayerEx = FeatureLayerUtil.getFeatureLayerById(ConstVO.River_Pollution_Compare_Layer, currentPlanMap);
				currentPlanMap.addLayer(featuresLayer);
				
				var recordSet:Recordset;
				var feature:Feature;
				var newFeature:Feature;
				var recordSets:Array = modelLocator.waterModelParam.riverDMList;
				for each(recordSet in recordSets)
				{
					if (recordSet.features != null && recordSet.features.length != 0)
					{
						for each (feature in recordSet.features)
						{
							newFeature = new Feature(feature.geometry);
							newFeature.id = feature.attributes.ID;
							newFeature.visible = false;
							newFeature.buttonMode = true;
							featuresLayer.addFeature(newFeature);
						}
					}
				}
				
				//添加两个地图图层
				baseMapLayer = new TiledDynamicRESTLayerEx();
				baseMapLayer.layerType = 0
				baseMapLayer.layerIndex = 1;
				baseMapLayer.bounds = modelLocator.systemInfo.layerBounds;
				baseMapLayer.url = modelLocator.baseMapInfo.baseVectorMapUrl;
				comparePlanMap.addLayer(baseMapLayer);
				
				waterResourceLayer = new TiledDynamicRESTLayerEx();
				waterResourceLayer.layerType = 1;
				waterResourceLayer.layerIndex = 1;
				waterResourceLayer.transparent = true;
				waterResourceLayer.layersID = modelLocator.systemInfo.lastLayerIds;
				waterResourceLayer.url = modelLocator.baseMapInfo.waterResourceVectorMapUrl;
				comparePlanMap.addLayer(waterResourceLayer);
				
				comparePlanMap.resolutions = modelLocator.mapCtrl.resolutions;
				
				featuresLayer = FeatureLayerUtil.getFeatureLayerById(ConstVO.River_Pollution_Compare_Layer, comparePlanMap);
				comparePlanMap.addLayer(featuresLayer);
				
				for each(recordSet in recordSets)
				{
					if (recordSet.features != null && recordSet.features.length != 0)
					{
						for each (feature in recordSet.features)
						{
							newFeature = new Feature(feature.geometry);
							newFeature.id = feature.attributes.ID;
							newFeature.visible = false;
							newFeature.buttonMode = true;
							featuresLayer.addFeature(newFeature);
						}
					}
				}
				
				initCompareMapViewBoundsHandler();
			}
			
			private function initCompareMapViewBoundsHandler():void
			{
				//				currentPlanMap.addEventListener(ViewBoundsEvent.VIEW_BOUNDS_CHANGE, viewBoundsChangeHandler);
				//				comparePlanMap.addEventListener(ViewBoundsEvent.VIEW_BOUNDS_CHANGE, viewBoundsChangeHandler);
			}
			
			private function viewBoundsChangeHandler(event:ViewBoundsEvent):void
			{
				var map:MapCtrl = event.currentTarget as MapCtrl;
				if (map != currentPlanMap) 
				{
					currentPlanMap.viewBounds = event.viewBounds;
				}
				if (map != comparePlanMap)
				{
					comparePlanMap.viewBounds = event.viewBounds;
				}
			}
			
			//当前时间轴选择的月份数据，根据月份数据，刷新河流段
			protected function timeSlider_changeHandler(event:TimeSliderEvent):void
			{
				var selectMonth:int = event.data as int; 
				//显示当前方案的数据
				var saData:Object;
				var month:int;
				var label:String;
				for each(saData in riverCompareResult.currentPlan)
				{
					label =saData["label"];
					month = -1;
					if (label.split("-").length == 2){
						month = parseInt(label.split("-")[1]);
					}
					if (month == selectMonth) {
						refreshPollutionRiver(saData, currentPlanMap);
						break;
					}
				}
				
				//遍历对比方案的数据
				for each(saData in riverCompareResult.comparePlan)
				{
					label =saData["label"];
					month = -1;
					if (label.split("-").length == 2){
						month = parseInt(label.split("-")[1]);
					}
					if (month == selectMonth) {
						refreshPollutionRiver(saData, comparePlanMap);
						break;
					}
				}
			}
			
			private function refreshPollutionRiver(datas:Object, map:MapCtrl):void
			{
				var featuresLayer:FeaturesLayerEx = FeatureLayerUtil.getFeatureLayerById(ConstVO.River_Pollution_Compare_Layer, map);
				for each(var item:Object in datas["nodeList"]) {
					
				}
			}
			
			protected function dmProfileNC_creationCompleteHandler(event:FlexEvent):void
			{
				startDmWaterLevelSimulate();
			}
			
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<mx:SolidColor id="sc1" color="#F5AC39"/>
		<mx:SolidColor id="sc2" color="#55D8FE"  />
		<s:SolidColorStroke id="s1" color="#F5AC39"/>
		<s:SolidColorStroke id="s2" color="#55D8FE"/>
		<s:SolidColorStroke id="s3" color="#1D66AE"/>
		<s:SolidColorStroke id="hd_s3" color="#FF0000"/>
		<s:SolidColorStroke id="s4" color="#712F82"/>
		<s:SolidColorStroke id="hd_s5" color="#0000FF"/>
		<s:SolidColorStroke id="s5" color="#FF00CC"/>
		<s:SolidColorStroke id="hd_wden_s5" color="#0000FF" weight="10"/>
		<mx:SeriesSlide  id="slide"  direction="up" elementOffset="0"/>
		<mx:SeriesSlide  id="slide2" direction="up"  elementOffset="0"/>
		<s:SolidColorStroke id="chartAxisStroke" color="#BBCCDD" weight="1" alpha="1"/>
		<mx:SeriesInterpolate id="areaSlide" duration="200"/>
		<mx:SeriesInterpolate id="areaSlide2" duration="200"/>
	</fx:Declarations>
	<ns:states>
		<s:State name="hideState"/>
		<s:State name="breakState"/>
		<s:State name="riverState"/>
		<s:State name="pollutionCompareState"/>
	</ns:states>
	<s:Panel id="panel" width="100%" height="100%" visible="false" visible.breakState="true" visible.riverState="true"
			 visible.pollutionCompareState="false">
		<s:controlBarContent>
			<fx:Array>
				<s:Button id="closeBt" skinClass="sm.wegis.szy.skins.CloseLoginButtonSkin" buttonMode="true"
						  click="closeBt_clickHandler(event)"/>
			</fx:Array>
		</s:controlBarContent>
		<!--断面信息展示-->
		<s:Group id="breakGroup" width="100%" height="100%" visible="false" visible.breakState="true" >
			<s:VGroup width="100%" height="100%" gap="3">
				<s:ButtonBar id="breakBTB" dataProvider="{breakVW}"/>
				<s:Rect width="100%" height="1">
					<s:fill>
						<s:SolidColor color="0x979797" alpha="0.5"/>
					</s:fill>
				</s:Rect>
				<mx:ViewStack id="breakVW" width="100%" height="100%">
					<s:NavigatorContent label="断面计算结果"  width="100%" height="100%">
						<s:VGroup  width="100%" height="100%" paddingLeft="5"  paddingTop="5" paddingRight="5" >
							<mx:Grid verticalGap="15" horizontalGap="20">
								<mx:GridRow>
									<mx:GridItem>
										<s:HGroup gap="10" >
											<s:Label text="指标：" height="100%"/>
											<s:DropDownList id="targetDpList" width="160" dataProvider="{targetsList}" 
															requireSelection="true" styleName="SystemSelectorStyle"
															change="targetDpList_changeHandler(event)"/>
										</s:HGroup>
									</mx:GridItem>
									<mx:GridItem>
										<s:HGroup gap="10">
											<s:Button id="queryBt" label="查询" buttonMode="true" styleName="SubmitRegisterStyle"  click="queryBt_clickHandler()"/>
											<s:Button id="dmExportBt" label="导出计算结果" buttonMode="true" styleName="SubmitRegisterStyle"
													  click="dmExportBt_clickHandler(event)"/>
										</s:HGroup>
										<s:HGroup id="dmPollutionTypeGroup"/>
									</mx:GridItem>
								</mx:GridRow>
							</mx:Grid>	
							<line:HLine width="100%"/>
							<chart:LineChartEx id="dmChart" width="100%" height="100%" 
											   dataTipFunction="dmDataTipFunction">
								<!-- vertical axis -->
								<chart:verticalAxis>
									<mx:LinearAxis id="verticalAxis" baseAtZero="false" />
								</chart:verticalAxis>
								<chart:verticalAxisRenderers>
									<mx:AxisRenderer axis="{verticalAxis}"  fontSize="12" axisStroke="{chartAxisStroke}" color="#0000A2" tickStroke="{chartAxisStroke}"/>
								</chart:verticalAxisRenderers>
								<!-- horizontal axis -->
								<chart:horizontalAxis>
									<mx:DateTimeAxis id="ca"  title="时间" interval="1" labelUnits="months" dataUnits="days"
													 displayLocalTime="true" parseFunction="dateParseFunction" labelFunction="dateFormatFunction"/>
								</chart:horizontalAxis>
								<!-- horizontal axis renderer -->
								<chart:horizontalAxisRenderers>
									<mx:AxisRenderer axis="{ca}"  fontSize="12" canDropLabels="true" color="#0000A2" axisStroke="{chartAxisStroke}"
													 tickStroke="{chartAxisStroke}"  labelRenderer="sm.wegis.szy.renders.AxisRendererEx"/>
								</chart:horizontalAxisRenderers>
								<chart:series>
								</chart:series>
							</chart:LineChartEx>
						</s:VGroup>
						<mx:ControlBar top="40" right="20">
							<mx:Legend id="dmLegend" dataProvider="{dmChart}" fontSize="12"  buttonMode="true"
									   direction="vertical" itemClick="hd_wpLegend_itemClickHandler(event)"/>
						</mx:ControlBar>
					</s:NavigatorContent>
					<s:NavigatorContent label="断面地形展示"  width="100%" height="100%">
						<s:VGroup  id="dmProfileNC"  width="100%" height="100%" paddingLeft="5"  paddingTop="5" paddingRight="5"
								   creationComplete="dmProfileNC_creationCompleteHandler(event)">
							<s:HGroup id="dmProfileGroup" gap="10" width="100%">
								<s:HSlider id="dmTimeSlider" width="100%" height="100%" 
										   liveDragging="true" doubleClickEnabled="false"
										   showDataTip="true" slideDuration="200" 
										   minimum="0" stepSize="1" snapInterval="1"
										   dataTipFormatFunction="dmProfileDataTipFunc"
										   change="dmTimeSlider_changeHandler(event)"/>
								<s:Button id="dmStartBt" label="开始" buttonMode="true" styleName="SubmitRegisterStyle" click="dmStartBt_clickHandler(event)"/>
								<s:Button id="dmStopBt" label="停止" buttonMode="true" styleName="SubmitRegisterStyle" click="dmStopBt_clickHandler(event)"/>
							</s:HGroup>
							<line:HLine width="100%"/>
							<s:HGroup width="100%" horizontalAlign="center" fontWeight="bold">
								<s:Label text="时间：" height="100%"/>
								<s:Label id="dmTimeLabel" width="80" height="100%"/>
								<s:Label text="水位(米)：" height="100%"/>
								<s:Label id="dmWpLabel" width="80" height="100%"/>
							</s:HGroup>
							<chart:AreaChartEx id="terrainProfileChart" height="100%" width="100%" showDataTips="true" 
										  seriesFilters="[]"
										  dataTipFunction="terrainProfileDataTipFunction">
								<!--用于定义统计图的XY轴样式及数值范围-->
								<chart:verticalAxis>
									<mx:LinearAxis  id="dmVerticalAxis"  title="高程"/>
								</chart:verticalAxis>
								<chart:verticalAxisRenderers>
									<mx:AxisRenderer axis="{dmVerticalAxis}" axisStroke="{chartAxisStroke}" color="#0000A2" tickStroke="{chartAxisStroke}"/>
								</chart:verticalAxisRenderers>
								<chart:horizontalAxis>
									<mx:LinearAxis id="dmHorizontalAxis" title="距离"/>
								</chart:horizontalAxis>
								<chart:horizontalAxisRenderers>
									<mx:AxisRenderer axis="{dmHorizontalAxis}"  canDropLabels="true" color="#0000A2" axisStroke="{chartAxisStroke}"  tickStroke="{chartAxisStroke}"/>
								</chart:horizontalAxisRenderers>
								<chart:series>
									<mx:AreaSeries id="dmWaterPosition"  xField="distance" yField="altitude" form="curve"/>
									<mx:AreaSeries id="dmTerrainProfile"  xField="distance" yField="altitude" form="curve" />
								</chart:series>
							</chart:AreaChartEx>
							<mx:ControlBar>
								<mx:Legend id="dmterrainProfileLegend" dataProvider="{terrainProfileChart}" fontSize="12"  buttonMode="true"
										   direction="horizontal"/>
							</mx:ControlBar>
						</s:VGroup>
					</s:NavigatorContent>
					<s:NavigatorContent label="断面对比"  width="100%" height="100%">
						<s:VGroup  width="100%" height="100%" paddingLeft="5"  paddingTop="5" paddingRight="5" >
							<s:HGroup gap="10" width="100%">
								<s:Label text="指标：" height="100%"/>
								<s:DropDownList id="targetDpCompareList" width="160" dataProvider="{targetsList}"  
												requireSelection="true" styleName="SystemSelectorStyle"
												change="targetDpCompareList_changeHandler(event)"/>
								<s:Spacer width="30"/>
								<s:Label text="对比方案：" height="100%"/>
								<s:DropDownList id="dmCompareSchemeList" width="160"  dataProvider="{DMcompareSchemeList}" labelField="planNm"
												requireSelection="true" styleName="SystemSelectorStyle"
												valueCommit="dmCompareSchemeList_valueCommitHandler(event)"/>
								<s:Spacer width="30"/>
								<s:Label text="对比断面：" height="100%"/>
								<s:DropDownList id="dmCompareList" width="160" dataProvider="{dmList}" labelField="sectionName"
												requireSelection="true" styleName="SystemSelectorStyle"
												change="dmCompareList_changeHandler(event)"/>
								<s:Spacer width="30"/>
								<s:Button id="queryCompareBt" label="查询" buttonMode="true" styleName="SubmitRegisterStyle"
										  click="queryCompareBt_clickHandler(event)"/>
								<s:HGroup id="dmCompareType"/>
							</s:HGroup>
							<line:HLine width="100%"/>
							<chart:LineChartEx id="dmCompareChart" width="100%" height="100%" 
											   dataTipFunction="dmDataTipFunction">
								<!-- vertical axis -->
								<chart:verticalAxis>
									<mx:LinearAxis id="verticalCompareAxis" baseAtZero="false" />
								</chart:verticalAxis>
								<chart:verticalAxisRenderers>
									<mx:AxisRenderer axis="{verticalCompareAxis}"  fontSize="12" axisStroke="{chartAxisStroke}" color="#0000A2" tickStroke="{chartAxisStroke}"/>
								</chart:verticalAxisRenderers>
								<!-- horizontal axis -->
								<chart:horizontalAxis>
									<mx:DateTimeAxis id="compareCa"  title="时间" interval="1" labelUnits="months" dataUnits="days"
													 displayLocalTime="true" parseFunction="dateParseFunction" labelFunction="dateFormatFunction"/>
								</chart:horizontalAxis>
								<!-- horizontal axis renderer -->
								<chart:horizontalAxisRenderers>
									<mx:AxisRenderer axis="{compareCa}"  fontSize="12" canDropLabels="true" color="#0000A2" axisStroke="{chartAxisStroke}"
													 tickStroke="{chartAxisStroke}"  labelRenderer="sm.wegis.szy.renders.AxisRendererEx"/>
								</chart:horizontalAxisRenderers>
								<chart:series>
								</chart:series>
							</chart:LineChartEx>
						</s:VGroup>
						<mx:ControlBar top="40" right="20">
							<mx:Legend id="dmCompareLegend" dataProvider="{dmCompareChart}" fontSize="12"  buttonMode="true"
									   direction="vertical" itemClick="hd_wpLegend_itemClickHandler(event)"/>
						</mx:ControlBar>
					</s:NavigatorContent>
				</mx:ViewStack>
			</s:VGroup>
		</s:Group>
		<!--河流信息展示-->
		<s:Group id="riverGroup" width="100%"  height="100%"  visible="false" visible.riverState="true" >
			<s:VGroup width="100%" height="100%" gap="3">
				<s:ButtonBar id="riverBTB" dataProvider="{riverVW}"/>
				<s:Rect width="100%" height="1">
					<s:fill>
						<s:SolidColor color="0x979797" alpha="0.5"/>
					</s:fill>
				</s:Rect>
				<mx:ViewStack id="riverVW" width="100%" height="100%">
					<s:NavigatorContent label="河道计算结果"  width="100%" height="100%">
						<s:VGroup  width="100%" height="100%" paddingLeft="5"  paddingTop="5" paddingRight="5">
							<mx:Grid verticalGap="15" horizontalGap="20">
								<mx:GridRow>
									<mx:GridItem>
										<s:HGroup gap="10" >
											<s:Label text="指标：" height="100%"/>
											<s:DropDownList id="targetRwList" width="160" dataProvider="{targetsList}"  
															requireSelection="true" styleName="SystemSelectorStyle"
															change="targetRwList_changeHandler(event)"/>
										</s:HGroup>
									</mx:GridItem>
									<mx:GridItem>
										<s:HGroup gap="10">
											<s:Button id="queryRwBt" label="查询" buttonMode="true"
													  styleName="SubmitRegisterStyle"
													  click="queryRwBt_clickHandler(event)"/>
											<s:Button id="exportRwBt" label="导出计算结果" buttonMode="true" 
													  styleName="SubmitRegisterStyle"
													  click="exportRwBt_clickHandler(event)"/>
										</s:HGroup>
									</mx:GridItem>
								</mx:GridRow>
							</mx:Grid>	
							<line:HLine width="100%"/>
							<chart:LineChartEx id="hdChart" width="100%" height="100%" 
											   dataTipFunction="hdDataTipFunction">
								<!-- vertical axis -->
								<chart:verticalAxis>
									<mx:LinearAxis id="hdVerticalAxis" baseAtZero="false" />
								</chart:verticalAxis>
								<chart:verticalAxisRenderers>
									<mx:AxisRenderer axis="{hdVerticalAxis}" fontSize="12" axisStroke="{chartAxisStroke}" color="#0000A2" tickStroke="{chartAxisStroke}"/>
								</chart:verticalAxisRenderers>
								<!-- horizontal axis -->
								<chart:horizontalAxis>
									<mx:LinearAxis id="hdHorizontalAxis" title="距离(m)" baseAtZero="false"/>
								</chart:horizontalAxis>
								<!-- horizontal axis renderer -->
								<chart:horizontalAxisRenderers>
									<mx:AxisRenderer axis="{hdHorizontalAxis}" canDropLabels="true" color="#0000A2" axisStroke="{chartAxisStroke}"
													 tickStroke="{chartAxisStroke}" fontSize="12"  labelRenderer="sm.wegis.szy.renders.AxisRendererEx"/>
								</chart:horizontalAxisRenderers>
							</chart:LineChartEx>
						</s:VGroup>
						<mx:ControlBar top="40" right="20">
							<mx:Legend id="hdLegend" dataProvider="{hdChart}"  fontSize="12"  buttonMode="true"
									   direction="vertical" itemClick="hd_wpLegend_itemClickHandler(event)"/>
						</mx:ControlBar>
					</s:NavigatorContent>
					<!--河道对比-->
					<s:NavigatorContent label="河道对比"  width="100%" height="100%">
						<s:VGroup width="100%" height="100%" paddingLeft="5">
							<mx:Grid verticalGap="15" horizontalGap="20">
								<mx:GridRow>
									<mx:GridItem>
										<s:HGroup gap="10" >
											<s:Label text="指标：" height="100%"/>
											<s:DropDownList id="riverTargetRwList" width="160" dataProvider="{targetsList}"  
															requireSelection="true" styleName="SystemSelectorStyle" valueCommit="riverTargetRwList_valueCommitHandler(event)"
															/>
											<s:Spacer width="30"/>
											<s:Label text="对比方案：" height="100%"/>
											<s:DropDownList id="riverCompareSchemeList" width="160"  dataProvider="{compareSchemeList}" labelField="planNm"
															requireSelection="true" styleName="SystemSelectorStyle"
															change="targetDpList_changeHandler(event)"/>
										</s:HGroup>
									</mx:GridItem>
									<mx:GridItem>
										<s:HGroup gap="10">
											<s:Button id="riverQueryRwBt" label="查询" buttonMode="true" styleName="SubmitRegisterStyle"
													  click="riverQueryRwBt_clickHandler(event)"/>
											<s:Button id="mapCompare" label="浓度地图展示" buttonMode="true" styleName="SubmitRegisterStyle"
													  click="riverQueryRwBt_clickHandler(event)"/>
										</s:HGroup>
									</mx:GridItem>
									<mx:GridItem>
										<s:HGroup gap="10">
											<s:Label text="选择对比月份：" height="100%"/>
											<s:DropDownList id="riverCompareMonthDpList"  enabled="false" requireSelection="true" width="160"
															styleName="SystemSelectorStyle" dataProvider="{riverCompareMonth}" 
															change="riverCompareMonthDpList_changeHandler(event)"/>
										</s:HGroup>
									</mx:GridItem>
								</mx:GridRow>
							</mx:Grid>	
							<line:HLine width="100%"/>
							
							<chart:LineChartEx id="riverCompareChart" width="100%" height="100%" 
											   dataTipFunction="hdDataTipFunction">
								<!-- vertical axis -->
								<chart:verticalAxis>
									<mx:LinearAxis id="riverVerticalAxis" baseAtZero="false" />
								</chart:verticalAxis>
								<chart:verticalAxisRenderers>
									<mx:AxisRenderer axis="{riverVerticalAxis}" fontSize="12" axisStroke="{chartAxisStroke}" color="#0000A2" tickStroke="{chartAxisStroke}"/>
								</chart:verticalAxisRenderers>
								<!-- horizontal axis -->
								<chart:horizontalAxis>
									<mx:LinearAxis id="riverHorizontalAxis" title="距离(m)" baseAtZero="false"/>
								</chart:horizontalAxis>
								<!-- horizontal axis renderer -->
								<chart:horizontalAxisRenderers>
									<mx:AxisRenderer axis="{riverHorizontalAxis}" canDropLabels="true" color="#0000A2" axisStroke="{chartAxisStroke}"
													 tickStroke="{chartAxisStroke}" fontSize="12"  labelRenderer="sm.wegis.szy.renders.AxisRendererEx"/>
								</chart:horizontalAxisRenderers>
							</chart:LineChartEx>
						</s:VGroup>
						<mx:ControlBar top="40" right="20">
							<mx:Legend dataProvider="{riverCompareChart}"  fontSize="12"  buttonMode="true"
									   direction="vertical" itemClick="hd_wpLegend_itemClickHandler(event)"/>
						</mx:ControlBar>
					</s:NavigatorContent>
				</mx:ViewStack>
			</s:VGroup>
		</s:Group>
	</s:Panel>
	<!--河道污染物浓度对比-->
	<s:Panel id="riverPollutionCompare" title="污染物浓度演进对比展示" width="100%" height="100%" 
			 visible="false" visible.pollutionCompareState="true">
		<s:controlBarContent>
			<fx:Array>
				<s:Button id="riverPollutionCompareCloseBt" skinClass="sm.wegis.szy.skins.CloseLoginButtonSkin" buttonMode="true"
						  click="riverPollutionCompareCloseBt_clickHandler(event)"/>
			</fx:Array>
		</s:controlBarContent>
		<s:VGroup width="100%" height="100%" gap="0">
			<s:BorderContainer width="100%" height="100%">
				<s:HGroup width="100%" height="100%" gap="0" >
					<ns:MapCtrl id="currentPlanMap" width="100%" height="100%"/>
					<line:VLine height="100%"/>
					<ns:MapCtrl id="comparePlanMap" width="100%" height="100%"/>
				</s:HGroup>
			</s:BorderContainer>
			<components:TimeSlider id="timeSlider" width="100%" change="timeSlider_changeHandler(event)"/>
		</s:VGroup>
	</s:Panel>
</ns:WidgetBase>
